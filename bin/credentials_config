#!/usr/bin/env ruby

require 'fileutils'

env_file = File.join(File.dirname(__FILE__), '..', '.env')

puts "Welcome! Let's start by setting your Marvel API credentials:"

FileUtils.touch(env_file) unless File.exist?(env_file)

content = File.read(env_file)

def get_key(key_name, content)
  if content.match(/^#{key_name}=/)
    content.match(/^#{key_name}=(.*)$/)[1]
  else
    nil
  end
end

def update_key(key_name)
  print "Enter your Marvel API #{key_name.capitalize} ðŸ”‘: "
  gets.strip
end

public_key = get_key('PUBLIC_KEY', content) || update_key('PUBLIC_KEY')

private_key = get_key('PRIVATE_KEY', content) || update_key('PRIVATE_KEY')

File.open(env_file, 'w') do |file|
  file.puts "PUBLIC_KEY=#{public_key}"
  file.puts "PRIVATE_KEY=#{private_key}"
end

puts "\nConfiguration updated in #{env_file}! ðŸ¦¸ðŸš€"
